<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Chat</title>
  </head>
  <body>
    <h2>Room Chat</h2>
    <div>
      <input type="text" id="nickname" placeholder="Enter your nickname" />
      <button onclick="joinRoom()">Join Room</button>
    </div>
    <ul id="participants-list"></ul>

    <script>
      let socket;
      const roomId = "9f9a4b9c-f24c-40d3-ba96-7a71398f5c5d"; // 방 ID를 실제 방 ID로 변경하세요.
      const url = `ws://127.0.0.1:8000/ws/rooms/${roomId}/`; // WebSocket URL

      function joinRoom() {
        const nickname = document.getElementById("nickname").value;

        // WebSocket 연결
        socket = new WebSocket(url);

        // WebSocket 연결 성공 시
        socket.onopen = function (event) {
          console.log("WebSocket connection established");
          // 참가자 정보를 서버로 전송
          socket.send(JSON.stringify({ nickname: nickname }));
        };

        // 서버에서 메시지를 받을 때
        socket.onmessage = function (event) {
          const data = JSON.parse(event.data);
          const participantsList = document.getElementById("participants-list");
          participantsList.innerHTML = ""; // 기존 참가자 목록 초기화

          // 참가자 목록을 HTML에 표시
          data.participants.forEach((participant) => {
            const li = document.createElement("li");
            li.textContent = participant;
            participantsList.appendChild(li);
          });
        };

        // WebSocket 연결이 닫힐 때
        socket.onclose = function (event) {
          console.log("WebSocket connection closed");
        };

        // WebSocket 연결 중 오류가 발생했을 때
        socket.onerror = function (error) {
          console.error("WebSocket error: ", error);
        };
      }
    </script>
  </body>
</html>
